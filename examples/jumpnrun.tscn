[gd_scene load_steps=40 format=3 uid="uid://b185xnr6xxyhc"]

[ext_resource type="Script" path="res://addons/pronto/behaviors/Placeholder.gd" id="1_tc671"]
[ext_resource type="Script" path="res://addons/pronto/behaviors/PlatformerController.gd" id="2_qr0oj"]
[ext_resource type="Script" path="res://addons/pronto/behaviors/Spawner.gd" id="3_7wwi6"]
[ext_resource type="Script" path="res://addons/pronto/behaviors/Key.gd" id="4_1kqu0"]
[ext_resource type="Script" path="res://addons/pronto/helpers/Connection.gd" id="5_jpml8"]
[ext_resource type="Script" path="res://addons/pronto/behaviors/Always.gd" id="5_kljok"]
[ext_resource type="Script" path="res://addons/pronto/behaviors/Collision.gd" id="6_nu8ty"]
[ext_resource type="Script" path="res://addons/pronto/behaviors/State.gd" id="9_an3v8"]

[sub_resource type="Resource" id="Resource_6pxs7"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("../../State")
invoke = "put"
arguments = ["return \"playerPos\"", "return from.get_parent().global_position"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_mmpws"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("..")
invoke = "move_and_slide"
arguments = []
only_if = "return G.at(\"is_on_static_grapple\") or G.at(\"is_on_normal_grapple\")"
expression = ""

[sub_resource type="Resource" id="Resource_6rtae"]
script = ExtResource("5_jpml8")
signal_name = "spawned"
to = NodePath("")
invoke = ""
arguments = []
only_if = "return true"
expression = "var parent = instance.get_parent()
if parent.get_child_count() > 1:
	parent.remove_child(parent.get_child(0))

instance.linear_velocity = (from.get_viewport().get_mouse_position() - G.at(\"playerPos\")).normalized() * G.at(\"init_grapple_speed\")"

[sub_resource type="Resource" id="Resource_o5k42"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../CharacterBody2D")
invoke = "set_position"
arguments = ["return from.get_parent().global_position"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_g8mp8"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("")
invoke = ""
arguments = []
only_if = "return true"
expression = "from.get_parent().set_sleeping(true)"

[sub_resource type="Resource" id="Resource_xstjp"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../CharacterBody2D/PlatformerController")
invoke = "set"
arguments = ["return \"gravity\"", "return 0"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_fcmup"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../CharacterBody2D/PlatformerController")
invoke = "set"
arguments = ["return \"is_on_static_grapple\"", "return true"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_qfd54"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("")
invoke = ""
arguments = []
only_if = "return true"
expression = "from.get_parent().set_sleeping(true)"

[sub_resource type="Resource" id="Resource_dvdr7"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../State")
invoke = "put"
arguments = ["return \"static_grapple_player_pos\"", "return G.at(\"playerPos\")"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_ipp8h"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../State")
invoke = "put"
arguments = ["return \"is_on_static_grapple\"", "return true"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_fwsaa"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../State")
invoke = "put"
arguments = ["return \"grapple_pos\"", "return from.get_parent().global_position"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_uuw3x"]
script = ExtResource("5_jpml8")
signal_name = "spawned"
to = NodePath("")
invoke = ""
arguments = []
only_if = "return true"
expression = "var parent = instance.get_parent()
if parent.get_child_count() > 1:
	parent.remove_child(parent.get_child(0))

instance.linear_velocity = (from.get_viewport().get_mouse_position() - G.at(\"playerPos\")).normalized() * G.at(\"init_grapple_speed\")"

[sub_resource type="Resource" id="Resource_pwhsi"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../CharacterBody2D/PlatformerController")
invoke = "set"
arguments = ["G.put(\"playerVelocity\",to.get_parent().get_velocity())
return \"is_on_static_grapple\"", "return true"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_r851i"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../CharacterBody2D")
invoke = "set_position"
arguments = ["return G.at(\"playerPos\")+((from.get_parent().global_position-G.at(\"playerPos\")) * 0.1)"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_fxtwo"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("")
invoke = ""
arguments = []
only_if = "return true"
expression = "from.get_parent().set_sleeping(true)"

[sub_resource type="Resource" id="Resource_l8q6s"]
script = ExtResource("5_jpml8")
signal_name = "collided"
to = NodePath("../../../State")
invoke = "put"
arguments = ["return \"is_on_normal_grapple\"", "return true"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_pr8wo"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("../../../CharacterBody2D")
invoke = "set_velocity"
arguments = ["var currentVelocity = G.at(\"playerVelocity\")
var grappleLine = (from.get_parent().global_position-G.at(\"playerPos\")).normalized()
var swingDir = grappleLine.rotated(deg_to_rad(90))


var newDir

if currentVelocity != Vector2(0,0):
	newDir = swingDir * currentVelocity.length()
	#newDir = swingDir * swingDir.dot(currentVelocity.normalized()) * 50
else:
	newDir = swingDir

var gravityInfluence = newDir * newDir.dot(Vector2(0,1))
currentVelocity = newDir + gravityInfluence
G.put(\"playerVelocity\", currentVelocity)
return currentVelocity
"]
only_if = "return G.at(\"is_on_normal_grapple\")"
expression = ""

[sub_resource type="Resource" id="Resource_gmt0n"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("../../../CharacterBody2D")
invoke = ""
arguments = []
only_if = "return true"
expression = "print(to.get_velocity())"

[sub_resource type="Resource" id="Resource_xp1tx"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("../Tele_Grapple_Spawner")
invoke = "set_position"
arguments = ["return G.at(\"playerPos\")"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_1clvj"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("../Static_Grapple_Spawner")
invoke = "set_position"
arguments = ["return G.at(\"playerPos\")"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_t43s0"]
script = ExtResource("5_jpml8")
signal_name = "always"
to = NodePath("../Normal_Grapple_Spawner")
invoke = "set_position"
arguments = ["return G.at(\"playerPos\")"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_3oxhf"]
script = ExtResource("5_jpml8")
signal_name = "down"
to = NodePath("../Tele_Grapple_Spawner")
invoke = "spawn"
arguments = []
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_4ko6u"]
script = ExtResource("5_jpml8")
signal_name = "down"
to = NodePath("../Static_Grapple_Spawner")
invoke = "spawn"
arguments = []
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_aesu6"]
script = ExtResource("5_jpml8")
signal_name = "pressed"
to = NodePath("../CharacterBody2D")
invoke = "set_velocity"
arguments = ["return (G.at(\"grapple_pos\") - G.at(\"playerPos\")).normalized() * G.at(\"grapple_speed\")"]
only_if = "return G.at(\"is_on_static_grapple\")"
expression = ""

[sub_resource type="Resource" id="Resource_pxct8"]
script = ExtResource("5_jpml8")
signal_name = "up"
to = NodePath("../CharacterBody2D")
invoke = "set_velocity"
arguments = ["return Vector2(0,0)"]
only_if = "return G.at(\"is_on_static_grapple\")"
expression = ""

[sub_resource type="Resource" id="Resource_b7q43"]
script = ExtResource("5_jpml8")
signal_name = "pressed"
to = NodePath("../CharacterBody2D")
invoke = "set_velocity"
arguments = ["return (G.at(\"static_grapple_player_pos\") - G.at(\"playerPos\")).normalized() * G.at(\"grapple_speed\")"]
only_if = "return G.at(\"is_on_static_grapple\")"
expression = ""

[sub_resource type="Resource" id="Resource_hkqq7"]
script = ExtResource("5_jpml8")
signal_name = "up"
to = NodePath("../CharacterBody2D")
invoke = "set_velocity"
arguments = ["return Vector2(0,0)"]
only_if = "return G.at(\"is_on_static_grapple\")"
expression = ""

[sub_resource type="Resource" id="Resource_268c8"]
script = ExtResource("5_jpml8")
signal_name = "down"
to = NodePath("../CharacterBody2D/PlatformerController")
invoke = "set"
arguments = ["return \"is_on_static_grapple\"", "return false"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_ivovv"]
script = ExtResource("5_jpml8")
signal_name = "down"
to = NodePath("../State")
invoke = "put"
arguments = ["return \"is_on_static_grapple\"", "return false"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_qp5aa"]
script = ExtResource("5_jpml8")
signal_name = "down"
to = NodePath("../State")
invoke = "put"
arguments = ["return \"is_on_normal_grapple\"", "return false"]
only_if = "return true"
expression = ""

[sub_resource type="Resource" id="Resource_518e6"]
script = ExtResource("5_jpml8")
signal_name = "down"
to = NodePath("../Normal_Grapple_Spawner")
invoke = "spawn"
arguments = []
only_if = "return true"
expression = ""

[node name="jumpnrun" type="Node2D"]

[node name="CharacterBody2D" type="CharacterBody2D" parent="."]
position = Vector2(527, 317)
collision_layer = 2

[node name="Placeholder" type="Node2D" parent="CharacterBody2D"]
script = ExtResource("1_tc671")
label = "guy"
placeholder_size = Vector2(20, 60)

[node name="PlatformerController" type="Node2D" parent="CharacterBody2D"]
position = Vector2(51, 30)
script = ExtResource("2_qr0oj")

[node name="Always" type="Node2D" parent="CharacterBody2D"]
position = Vector2(42, -97)
script = ExtResource("5_kljok")
metadata/pronto_connections = [SubResource("Resource_6pxs7"), SubResource("Resource_mmpws")]

[node name="Tele_Grapple_Spawner" type="Node2D" parent="."]
position = Vector2(538, 539)
script = ExtResource("3_7wwi6")
metadata/pronto_connections = [SubResource("Resource_6rtae")]

[node name="RigidBody2D" type="RigidBody2D" parent="Tele_Grapple_Spawner"]
collision_layer = 2

[node name="Placeholder" type="Node2D" parent="Tele_Grapple_Spawner/RigidBody2D"]
script = ExtResource("1_tc671")
label = "Grapple"
color = Color(1, 0.513726, 1, 1)

[node name="Collision" type="Node2D" parent="Tele_Grapple_Spawner/RigidBody2D"]
position = Vector2(-28, 47)
script = ExtResource("6_nu8ty")
metadata/pronto_connections = [SubResource("Resource_o5k42"), SubResource("Resource_g8mp8"), SubResource("Resource_xstjp")]

[node name="Static_Grapple_Spawner" type="Node2D" parent="."]
position = Vector2(830, 413)
script = ExtResource("3_7wwi6")
metadata/pronto_connections = [SubResource("Resource_6rtae")]

[node name="RigidBody2D" type="RigidBody2D" parent="Static_Grapple_Spawner"]
collision_layer = 2

[node name="Placeholder" type="Node2D" parent="Static_Grapple_Spawner/RigidBody2D"]
script = ExtResource("1_tc671")
label = "Grapple"
color = Color(1, 0.513726, 1, 1)

[node name="Collision" type="Node2D" parent="Static_Grapple_Spawner/RigidBody2D"]
position = Vector2(-28, 47)
script = ExtResource("6_nu8ty")
metadata/pronto_connections = [SubResource("Resource_fcmup"), SubResource("Resource_qfd54"), SubResource("Resource_dvdr7"), SubResource("Resource_ipp8h"), SubResource("Resource_fwsaa")]

[node name="Normal_Grapple_Spawner" type="Node2D" parent="."]
position = Vector2(1089, 479)
script = ExtResource("3_7wwi6")
metadata/pronto_connections = [SubResource("Resource_uuw3x")]

[node name="RigidBody2D" type="RigidBody2D" parent="Normal_Grapple_Spawner"]
collision_layer = 2

[node name="Placeholder" type="Node2D" parent="Normal_Grapple_Spawner/RigidBody2D"]
script = ExtResource("1_tc671")

[node name="Collision" type="Node2D" parent="Normal_Grapple_Spawner/RigidBody2D"]
position = Vector2(-24, 63)
script = ExtResource("6_nu8ty")
metadata/pronto_connections = [SubResource("Resource_pwhsi"), SubResource("Resource_r851i"), SubResource("Resource_fxtwo"), SubResource("Resource_l8q6s")]

[node name="Always2" type="Node2D" parent="Normal_Grapple_Spawner/RigidBody2D"]
position = Vector2(112, 54)
script = ExtResource("5_kljok")
metadata/pronto_connections = [SubResource("Resource_pr8wo"), SubResource("Resource_gmt0n")]

[node name="State" type="Node2D" parent="."]
position = Vector2(754, 324)
script = ExtResource("9_an3v8")
global = true
metadata/playerPos = Vector2(0, 0)
metadata/init_grapple_speed = 2000
metadata/is_on_static_grapple = false
metadata/static_grapple_player_pos = Vector2(0, 0)
metadata/grapple_pos = Vector2(0, 0)
metadata/grapple_speed = 200
metadata/is_on_normal_grapple = false
metadata/playerVelocity = Vector2(0, 0)

[node name="Always" type="Node2D" parent="."]
position = Vector2(638, 383)
script = ExtResource("5_kljok")
metadata/pronto_connections = [SubResource("Resource_xp1tx"), SubResource("Resource_1clvj"), SubResource("Resource_t43s0")]

[node name="Key" type="Node2D" parent="."]
position = Vector2(403, 544)
script = ExtResource("4_1kqu0")
key = "E"
metadata/pronto_connections = [SubResource("Resource_3oxhf")]

[node name="StaticBody2D5" type="StaticBody2D" parent="."]
position = Vector2(389, 306)
rotation = 0.476859

[node name="Placeholder" type="Node2D" parent="StaticBody2D5"]
position = Vector2(1, 16)
script = ExtResource("1_tc671")
color = Color(0.0313726, 0.658824, 0, 1)
placeholder_size = Vector2(457, 36)

[node name="StaticBody2D6" type="StaticBody2D" parent="."]
position = Vector2(978, 594)

[node name="Placeholder" type="Node2D" parent="StaticBody2D6"]
position = Vector2(1, 16)
script = ExtResource("1_tc671")
color = Color(0.0313726, 0.658824, 0, 1)
placeholder_size = Vector2(88, 71)

[node name="StaticBody2D2" type="StaticBody2D" parent="."]
position = Vector2(683, 443)

[node name="Placeholder" type="Node2D" parent="StaticBody2D2"]
position = Vector2(1, 16)
script = ExtResource("1_tc671")
color = Color(0.0313726, 0.658824, 0, 1)
placeholder_size = Vector2(88, 71)

[node name="StaticBody2D" type="StaticBody2D" parent="."]
position = Vector2(563, 624)

[node name="Placeholder" type="Node2D" parent="StaticBody2D"]
position = Vector2(1, 16)
script = ExtResource("1_tc671")
color = Color(0.0313726, 0.658824, 0, 1)
placeholder_size = Vector2(2000, 40)

[node name="StaticBody2D3" type="StaticBody2D" parent="."]
position = Vector2(899, 528)

[node name="Placeholder" type="Node2D" parent="StaticBody2D3"]
position = Vector2(1, 16)
script = ExtResource("1_tc671")
color = Color(0.0313726, 0.658824, 0, 1)
placeholder_size = Vector2(88, 71)

[node name="StaticBody2D4" type="StaticBody2D" parent="."]
position = Vector2(763, 590)

[node name="Placeholder" type="Node2D" parent="StaticBody2D4"]
position = Vector2(1, 16)
script = ExtResource("1_tc671")
color = Color(0.0313726, 0.658824, 0, 1)
placeholder_size = Vector2(88, 71)

[node name="Key2" type="Node2D" parent="."]
position = Vector2(919, 373)
script = ExtResource("4_1kqu0")
key = "Q"
metadata/pronto_connections = [SubResource("Resource_4ko6u")]

[node name="Key3" type="Node2D" parent="."]
position = Vector2(763, 544)
script = ExtResource("4_1kqu0")
key = "P"
metadata/pronto_connections = [SubResource("Resource_aesu6"), SubResource("Resource_pxct8")]

[node name="Key4" type="Node2D" parent="."]
position = Vector2(765, 511)
script = ExtResource("4_1kqu0")
key = "L"
metadata/pronto_connections = [SubResource("Resource_b7q43"), SubResource("Resource_hkqq7")]

[node name="Key5" type="Node2D" parent="."]
position = Vector2(834, 604)
script = ExtResource("4_1kqu0")
key = "Space"
metadata/pronto_connections = [SubResource("Resource_268c8"), SubResource("Resource_ivovv"), SubResource("Resource_qp5aa")]

[node name="Key6" type="Node2D" parent="."]
position = Vector2(1153, 445)
script = ExtResource("4_1kqu0")
key = "R"
metadata/pronto_connections = [SubResource("Resource_518e6")]
